<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">


<head >
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>AL Note </title>
    <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" rel="stylesheet">
    <link href="../../static/lib/editormd/css/editormd.css" th:href="@{/lib/editormd/css/editormd.css}" rel="stylesheet" >
    <link href="../../static/css/index.css" th:href="@{/css/index.css}" rel="stylesheet">
</head>

<body>
    <!-- å¯¼èˆª -->
    <nav class="ui inverted segment  attached my-padding-tb" >
        <div class="ui container">
            <div class="ui inverted secondary stackable menu">
                <h2 class="ui teal header item"><a th:href="@{/}">Active Life</a></h2>
                <a class="item my-mobile-hide c-item my-font-bigsmall" href="note_index.html" th:href="@{/bj/note-index}">ğŸ’é¦–é¡µ</a>
                <a class="item my-mobile-hide c-item my-font-bigsmall" href="noteClass.html" th:href="@{/bj/type/-1}">ğŸ‰åˆ†ç±»</a>
                <a class="item my-mobile-hide c-item my-font-bigsmall" href="noteTag.html" th:href="@{/bj/tag/-1}">ğŸ‘£æ ‡ç­¾</a>
                <a class="item my-mobile-hide c-item my-font-bigsmall" href="noteHome.html" th:href="@{/bj/home}">ğŸå½’æ¡£</a>
                <div class="right c-item item my-mobile-hide ">
                    <div class="ui dropdown item  my-mobile-hide c-item ">
                        <div class="text">
                            <span th:text="${session.user.nickname}">ææ³½åº†</span>
                        </div>
                        <i class="icon dropdown"></i>
                        <div class="menu">
                            <a class="item" href="NoteManager.html" th:href="@{/bj/notes}">ğŸ¤ªæˆ‘çš„æ§åˆ¶å°</a>
                            <a class="item" href="../login.html" th:href="@{/bj/exit}">ğŸ˜­é€€å‡ºç™»å½•</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- æ±‰å ¡ -->
        <span class="ui black button my-hanbao my-mobile-show" href="#" id="toggle-menu"><span class="" style="font-size: 30px;">ğŸ”</span></span>
    </nav>
    <div class="ui attached menu pointing">
        <div class=" ui  container">
            <div class="right menu " >
                <a  class="item active" href="#"  style="font-weight: bold"  th:href="@{#}">ä¸ªäººä¸­å¿ƒ</a>
                <a  class="item " href="NoteManager.html" th:href="@{/bj/notes}">ç¬”è®°åˆ—è¡¨</a>
                <a  class="item" href="#" th:href="@{/bj/types}">åˆ†ç±»</a>
                <a  class="item " href="#"   th:href="@{/bj/tags}">æ ‡ç­¾</a>
                <a class="item " href="#"  th:href="@{/bj/noteRelease}">å‘å¸ƒ</a>
            </div>
        </div>
    </div>
    <br>
    <br>

    <input type="hidden" id="userid" th:value="${session.user.id}">
    <!-- ä¸­é—´å†…å®¹ -->
    <div class="my-container centered">
        <div class="ui container">
            <div class="ui teal  inverted stackable segment">
             <div class="ui segment teal">
                <div class="ui items ">
                    <div class="item">
                        <div class="ui small image">
                            <label class="ui teal label" >æ˜µç§°</label>
                        </div>
                        <div class=" middle aligned content ">
                            <a class="header nickname" th:text="${session.user.nickname}">ææ³½åº†</a>
                        </div>
                        <div style="width: 60%;text-align: right">
                            <button class="ui mini button"  onclick="upNickname()">ä¿®æ”¹</button>
                        </div>
                    </div>
                    <div class="item">
                        <div class="ui small image">
                             <label class="ui teal label">æ‰‹æœºå·</label>
                        </div>
                        <div class="middle aligned content">
                            <a class="header"  th:text="${session.user.phone}">15034344690</a>
                        </div>
                    </div>

                    <div class="item">
                        <div class="ui small image">
                            <label class="ui teal label" >å¯†ç </label>
                        </div>
                        <div class="middle aligned content">
                            <a class="header">********</a>
                        </div>
                        <div style="width: 60%;text-align:right">
                        <button class="ui mini button" onclick="upPassword()">ä¿®æ”¹</button>
                        </div>
                    </div>
                    <div class="item">
                        <div class="ui small image">
                            <label class="ui teal label" >æ˜¯å¦å¼€å¯äººè„¸ç™»å½•</label>
                        </div>
                        <div class="middle aligned content">
                            <a class="header" th:text="${session.user.face?'âœ”':'âŒ'}">âŒ</a>
                        </div>
                        <div style="width: 60%;text-align:right">
                        <button class="ui mini button" onclick="startFace()" th:text="${session.user.face?'ä¿®æ”¹':'å¼€å¯'}">å¼€å¯</button>
                        </div>
                    </div>
                </div>
             </div>

            </div>
        </div>
    </div>

    <!--ä¿®æ”¹æ˜µç§°-->
    <div class="ui modal tiny nickname">
        <i class="close icon"></i>
        <div class="header">
            ä¿®æ”¹æ˜µç§°
        </div>
        <div class="image content ui input">
            <input type="text" name="nickname" id="nickname" placeholder="è¯·è¾“å…¥ä¿®æ”¹åçš„æ˜µç§°">
        </div>
        <div class="actions">
            <button class="ui inverted green  button" onclick="updateName()">
                ä¿®æ”¹
            </button>
        </div>
    </div>


    <!--ä¿®æ”¹å¯†ç -->
    <div class="ui modal tiny password">
        <i class="close icon"></i>
        <div class="header">
            ä¿®æ”¹å¯†ç 
        </div>
        <div class="image content ui input">
            <input type="hidden" name="passwordOld" id="passwordOld" th:value="${session.user.password}">
            <input type="text" name="password" id="password" placeholder="è¯·è¾“å…¥åŸå§‹å¯†ç ">
            <div class="ui horizontal divider">-></div>
            <input type="text" name="passwordNew" id="passwordNew" placeholder="è¯·è¾“å…¥æ–°å¯†ç ">
        </div>
        <div class="actions">
            <button class="ui inverted green button" onclick="updatePass()">
                ä¿®æ”¹
            </button>
        </div>
    </div>
    <!--å¼€å¯äººè„¸ç™»å½•-->
    <div class="ui modal tiny face">
        <i class="close icon"></i>
        <div class="header">
            è¯·ä¸Šä¼ ä½ çš„é¢éƒ¨ç…§ç‰‡
        </div>
        <div class="image content ui input">
            <!-- å›¾ç‰‡æ–‡æœ¬æ¡† -->
            <input type="file" class="form-control" id="file" name="file"  onchange="preview(this)">
            <!-- è¿™ä¸ªæ˜¯åœ¨ä¸Šä¼ ä¹‹å‰å›æ˜¾å›¾ç‰‡å›¾ç‰‡å±•ç¤º -->
            <div id="preview">
                ã€€ã€€<!--è¿™ä¸ªæ˜¯ä¸ºäº†å°†é¡µé¢è¿”å›çš„å›¾ç‰‡å±•ç¤ºå‡ºæ¥çš„.é»˜è®¤éšè—-->
                ã€€ã€€<img style="width: 100px; height: 100px;display:none" id="imgHidden" />
            </div>
        </div>
        <div class="actions">
            <button class="ui inverted green button" onclick="updateFace()">
                æäº¤
            </button>
        </div>
    </div>
    <!-- åº•éƒ¨ -->
    <footer class="ui inverted vertical segment my-padding-shuxian my-margin-top-small " >
        <div class="ui center aligned container">
            <div class="ui inverted divided grid stackable">
                <div class="four wide  column">
                    <div class="ui inverted link list">
                        <div class="item">
                            <img class="ui rounded image" src="../../static/img/wx.jpg" th:src="@{/img/wx.jpg}" style="height: 50% !important;width: 50% !important;">
                        </div>
                    </div>
                </div>
                <div class="four wide column">
                    <h4 class="ui inverted header my-opacity-font">å­¦æ ¡</h4>
                    <div class="ui inverted link list">
                        <a class="item" href="">>---è¿åŸå­¦é™¢---<</a>
                        <a class="item" href="">>---æ•°å­¦ä¸ä¿¡æ¯æŠ€æœ¯å­¦é™¢---<</a>
                    </div>
                </div>
                <div class="four wide column">
                    <h4 class="ui inverted header my-opacity-font">è”ç³»æˆ‘</h4>
                    <div class="ui inverted link list">
                        <span class="item" href="">phone:15034344690</span>
                        <span class="item" href="">QQ:905866484</span>
                        <span class="item" href="">email:905866484@qq.com</span>
                    </div>
                </div>
                <div class="four wide column">
                    <h4 class="ui inverted header my-opacity-font">NotForzq</h4>
                    <div class="ui inverted link list">
                        <span class="item">------------------------</span>
                        <span class="item" href="#"> å­¦ä¹ ä¸ä»…ä»…æ˜¯ä¸ºäº†è‡ªå·±ï¼å‰æ–¹ä¸ä¼šå­¤å•ï¼</span>
                        <span class="item">------------------------</span>
                    </div>
                </div>
            </div>
            <div class="ui inverted section divider"></div>
            <p class="item my-opacity-font">Welcome to Active Life, since 2020</p>
            <p class="item my-opacity-font" href="http://www.beian.miit.gov.cn/">æ™‹ICPå¤‡20001376å·-1</p>
        </div>

    </footer>
<!--    <script src="http://lib.sinaapp.com/js/jquery/2.0.2/jquery-2.0.2.min.js"></script>-->
    <script src="../../static/js/jquery-2.1.0.min.js" th:src="@{/js/jquery-2.1.0.min.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
    <script src="../../static/js/jhbg.js" th:src="@{/js/jhbg.js}"> </script>
    <script src="../../static/js/layer/layer.js" th:src="@{/js/layer/layer.js}"></script>
    <script>
        var $user = document.getElementById("userid");
        var userid = $user.value;

        $("#toggle-menu").click(function() {
            $('.c-item').toggleClass('my-mobile-hide');
        });
        $('.ui.dropdown')
            .dropdown({
                on: 'hover'
            });
        $('.ui.form').form({
                fields: {
                    title: {
                        indentifier: 'title',
                        rules: [{
                            type: 'empty',
                            prompt: 'è¯·è¾“å…¥åšå®¢æ ‡é¢˜'
                        }]
                    }
                }
            });
        function upNickname() {
            $('.ui.tiny.modal.nickname').modal('show');
        }
        function upPassword() {
            $('.ui.tiny.modal.password').modal('show');
        }
        function startFace() {
            $('.ui.tiny.modal.face').modal('show');
        }

        function updateName() {
            var nickname = document.getElementById("nickname");
            if(nickname.value == ""){
                layer.msg("è¯·è¾“å…¥æ˜µç§°");return;
            }
            $.ajax({
                type : "POST",
                async : false,
                url : "/bj/updateNickname",
                data : {
                    nickname : nickname.value,
                    id : userid
                },
                success : function(data) {
                    //è¿”å›çš„ç»“æœ
                    console.log(data);
                    $('.ui.tiny.modal.nickname').modal('hide');
                    window.location.reload(true);
                }
            });
        }

        function updatePass() {
            var $pass = document.getElementById("password");
            var $new = document.getElementById("passwordNew");
            if($pass.value == ""){layer.msg("è¯·è¾“å…¥æ—§å¯†ç ");return;}
            if($new.value == ""){layer.msg("è¯·è¾“å…¥æ–°å¯†ç ");return;}
            $.ajax({
                type : "POST",
                async : false,
                url : "/bj/updatePassword",
                data : {
                    id : userid,
                    newPass: $new.value,
                    oldPass: $pass.value
                },
                success : function(data) {
                    //è¿”å›çš„ç»“æœ
                    console.log(data);
                    if(data.status == 200){
                        $('.ui.tiny.modal.password').modal('hide');
                    }else{
                        layer.msg(data.mag);
                    }

                }
            });
        }
        //å›¾ç‰‡å›æ˜¾:
        function preview(file) {
            $("#imgHidden").css("display", "none");
            var prevDiv = document.getElementById('preview');
            if (file.files && file.files[0]) {
                var reader = new FileReader();
                reader.onload = function(evt) {
                    prevDiv.innerHTML = '<img style="width: 100px;height: 100px;" src="' + evt.target.result + '" />';
                }
                reader.readAsDataURL(file.files[0]);
            } else {
                prevDiv.innerHTML = '<div class="img" style="width: 100px;height:100px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src=\'' +
                    file.value + '\'"></div>';
            }
        }

        function updateFace() {
            var $img = document.getElementById('file');
            //è·å–å½“å‰å›¾åƒå¹¶è½¬æ¢ä¸ºBase64çš„å­—ç¬¦ä¸²

            //æˆªå–å­—ç¬¦ä¸²
            var imgFile = new FileReader();
            imgFile.readAsDataURL($img.files[0]);

            imgFile.onload = function () {
                var imgBase64 = this.result.substring(23); //base64æ•°æ®
                console.log(imgBase64);
                $.ajax({
                    type : "POST",
                    async : false,
                    url : "/bj/updateFace",
                    data : {
                        img : imgBase64,
                        id : userid
                    },
                    dataType : "JSON",
                    success : function(data) {
                        //è¿”å›çš„ç»“æœ
                        console.log(data)
                        if(data.status == 200){
                            $('.ui.tiny.modal.face').modal('hide');
                            window.location.reload(true);
                        }else{
                            layer.msg(data.msg);
                        }
                    }
                });

            }

            //Ajaxå°†Base64å­—ç¬¦ä¸²ä¼ è¾“åˆ°åå°å¤„ç†

        }

    </script>
</body>

</html>